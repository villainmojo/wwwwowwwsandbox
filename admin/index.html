<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì - SENGVIS Playground</title>
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <script src="https://accounts.google.com/gsi/client" async defer>

        // ===== BLOG ADMIN =====
        let blogEditor = null;

        function ensureBlogEditor(){
            if(blogEditor) return blogEditor;
            if(!window.toastui || !toastui.Editor) throw new Error('Editor library not loaded');
            blogEditor = new toastui.Editor({
                el: document.querySelector('#blogEditor'),
                height: '520px',
                initialEditType: 'wysiwyg',
                previewStyle: 'vertical',
                usageStatistics: false,
                toolbarItems: [
                    ['heading', 'bold', 'italic', 'strike'],
                    ['hr', 'quote'],
                    ['ul', 'ol', 'task'],
                    ['table', 'image', 'link'],
                    ['code', 'codeblock'],
                    ['scrollSync']
                ],
                hooks: {
                    addImageBlobHook: async (blob, callback) => {
                        try{
                            const token = localStorage.getItem('adminToken');
                            if(!token) throw new Error('ê´€ë¦¬ì ë¡œê·¸ì¸ í•„ìš”');
                            const dataUrl = await new Promise((resolve, reject)=>{
                                const r = new FileReader();
                                r.onload = ()=>resolve(String(r.result));
                                r.onerror = ()=>reject(new Error('read failed'));
                                r.readAsDataURL(blob);
                            });
                            const ext = (blob.type.split('/')[1] || 'png').replace('jpeg','jpg');
                            const filename = `img_${Date.now()}.${ext}`;
                            const res = await fetch('/api/admin/blog/upload', {
                                method:'POST',
                                headers: { 'Content-Type':'application/json', 'Authorization': `Bearer ${token}` },
                                body: JSON.stringify({ filename, dataUrl })
                            });
                            const out = await res.json();
                            if(!out.success) throw new Error(out.error||'upload failed');
                            callback(out.url, filename);
                        }catch(e){
                            alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
                        }
                        return false;
                    }
                }
            });
            return blogEditor;
        }

        async function apiAdmin(path, opts={}){
            if(!authToken) throw new Error('not logged in');
            const res = await fetch(path, {
                ...opts,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                    ...(opts.headers||{})
                }
            });
            const data = await res.json().catch(()=>({}));
            if(!res.ok || data.success === false) throw new Error(data.error || ('HTTP '+res.status));
            return data;
        }

        function setBlogStatus(msg){
            const el = document.getElementById('blogStatus');
            if(el) el.textContent = msg || '';
        }

        function editorSetMarkdown(md){
            document.getElementById('blogMd').value = md || '';
            try{ ensureBlogEditor().setMarkdown(md || ''); }catch(e){ /* ignore */ }
        }

        function editorGetMarkdown(){
            try{ return ensureBlogEditor().getMarkdown(); }
            catch(e){ return document.getElementById('blogMd').value || ''; }
        }

        async function loadBlogPosts(){
            setBlogStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
            const data = await apiAdmin('/api/admin/blog/posts');
            const list = document.getElementById('blogList');
            list.innerHTML='';
            (data.posts||[]).forEach(p=>{
                const a=document.createElement('button');
                a.className='tab';
                a.style.textAlign='left';
                a.style.width='100%';
                a.style.background='rgba(255,255,255,0.06)';
                a.style.border='1px solid rgba(255,255,255,0.10)';
                a.style.borderRadius='10px';
                a.style.padding='10px 12px';
                a.innerHTML = `<div style="font-weight:700">${p.title||p.slug}</div><div style="font-size:12px;opacity:.7">${p.slug} Â· ${p.date||''}</div>`;
                a.onclick=()=>openBlogPost(p.slug);
                list.appendChild(a);
            });
            setBlogStatus(`${(data.posts||[]).length}ê°œ`);
        }

        async function openBlogPost(slug){
            setBlogStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
            const data = await apiAdmin('/api/admin/blog/post?slug='+encodeURIComponent(slug));
            document.getElementById('blogSlug').value = data.slug;
            editorSetMarkdown(data.md);
            setBlogStatus('ë¡œë“œ ì™„ë£Œ');
        }

        function newBlogPost(){
            document.getElementById('blogSlug').value = '';
            editorSetMarkdown(`---\ntitle: ìƒˆ ê¸€\ndate: ${(new Date()).toISOString().slice(0,10)}\ntags: []\n---\n\n`);
            setBlogStatus('ìƒˆ ê¸€');
        }

        async function saveBlogPost(){
            const slug = (document.getElementById('blogSlug').value||'').trim();
            const md = editorGetMarkdown() || '';
            document.getElementById('blogMd').value = md;
            setBlogStatus('ì €ì¥ ì¤‘â€¦');
            await apiAdmin('/api/admin/blog/post', {method:'POST', body: JSON.stringify({slug, md})});
            setBlogStatus('ì €ì¥ ì™„ë£Œ (ë°œí–‰ í•„ìš”)');
            await loadBlogPosts();
        }

        async function publishBlog(){
            if(!confirm('ë°œí–‰í•˜ë©´ ì‚¬ì´íŠ¸(/blog)ì— ë°˜ì˜ë©ë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?')) return;
            setBlogStatus('ë°œí–‰ ì¤‘â€¦ (ìµœëŒ€ 20ì´ˆ)');
            await apiAdmin('/api/admin/blog/publish', {method:'POST', body: JSON.stringify({})});
            setBlogStatus('ë°œí–‰ ì™„ë£Œ');
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js">

        // ===== BLOG ADMIN =====
        let blogEditor = null;

        function ensureBlogEditor(){
            if(blogEditor) return blogEditor;
            if(!window.toastui || !toastui.Editor) throw new Error('Editor library not loaded');
            blogEditor = new toastui.Editor({
                el: document.querySelector('#blogEditor'),
                height: '520px',
                initialEditType: 'wysiwyg',
                previewStyle: 'vertical',
                usageStatistics: false,
                toolbarItems: [
                    ['heading', 'bold', 'italic', 'strike'],
                    ['hr', 'quote'],
                    ['ul', 'ol', 'task'],
                    ['table', 'image', 'link'],
                    ['code', 'codeblock'],
                    ['scrollSync']
                ],
                hooks: {
                    addImageBlobHook: async (blob, callback) => {
                        try{
                            const token = localStorage.getItem('adminToken');
                            if(!token) throw new Error('ê´€ë¦¬ì ë¡œê·¸ì¸ í•„ìš”');
                            const dataUrl = await new Promise((resolve, reject)=>{
                                const r = new FileReader();
                                r.onload = ()=>resolve(String(r.result));
                                r.onerror = ()=>reject(new Error('read failed'));
                                r.readAsDataURL(blob);
                            });
                            const ext = (blob.type.split('/')[1] || 'png').replace('jpeg','jpg');
                            const filename = `img_${Date.now()}.${ext}`;
                            const res = await fetch('/api/admin/blog/upload', {
                                method:'POST',
                                headers: { 'Content-Type':'application/json', 'Authorization': `Bearer ${token}` },
                                body: JSON.stringify({ filename, dataUrl })
                            });
                            const out = await res.json();
                            if(!out.success) throw new Error(out.error||'upload failed');
                            callback(out.url, filename);
                        }catch(e){
                            alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
                        }
                        return false;
                    }
                }
            });
            return blogEditor;
        }

        async function apiAdmin(path, opts={}){
            if(!authToken) throw new Error('not logged in');
            const res = await fetch(path, {
                ...opts,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                    ...(opts.headers||{})
                }
            });
            const data = await res.json().catch(()=>({}));
            if(!res.ok || data.success === false) throw new Error(data.error || ('HTTP '+res.status));
            return data;
        }

        function setBlogStatus(msg){
            const el = document.getElementById('blogStatus');
            if(el) el.textContent = msg || '';
        }

        function editorSetMarkdown(md){
            document.getElementById('blogMd').value = md || '';
            try{ ensureBlogEditor().setMarkdown(md || ''); }catch(e){ /* ignore */ }
        }

        function editorGetMarkdown(){
            try{ return ensureBlogEditor().getMarkdown(); }
            catch(e){ return document.getElementById('blogMd').value || ''; }
        }

        async function loadBlogPosts(){
            setBlogStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
            const data = await apiAdmin('/api/admin/blog/posts');
            const list = document.getElementById('blogList');
            list.innerHTML='';
            (data.posts||[]).forEach(p=>{
                const a=document.createElement('button');
                a.className='tab';
                a.style.textAlign='left';
                a.style.width='100%';
                a.style.background='rgba(255,255,255,0.06)';
                a.style.border='1px solid rgba(255,255,255,0.10)';
                a.style.borderRadius='10px';
                a.style.padding='10px 12px';
                a.innerHTML = `<div style="font-weight:700">${p.title||p.slug}</div><div style="font-size:12px;opacity:.7">${p.slug} Â· ${p.date||''}</div>`;
                a.onclick=()=>openBlogPost(p.slug);
                list.appendChild(a);
            });
            setBlogStatus(`${(data.posts||[]).length}ê°œ`);
        }

        async function openBlogPost(slug){
            setBlogStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
            const data = await apiAdmin('/api/admin/blog/post?slug='+encodeURIComponent(slug));
            document.getElementById('blogSlug').value = data.slug;
            editorSetMarkdown(data.md);
            setBlogStatus('ë¡œë“œ ì™„ë£Œ');
        }

        function newBlogPost(){
            document.getElementById('blogSlug').value = '';
            editorSetMarkdown(`---\ntitle: ìƒˆ ê¸€\ndate: ${(new Date()).toISOString().slice(0,10)}\ntags: []\n---\n\n`);
            setBlogStatus('ìƒˆ ê¸€');
        }

        async function saveBlogPost(){
            const slug = (document.getElementById('blogSlug').value||'').trim();
            const md = editorGetMarkdown() || '';
            document.getElementById('blogMd').value = md;
            setBlogStatus('ì €ì¥ ì¤‘â€¦');
            await apiAdmin('/api/admin/blog/post', {method:'POST', body: JSON.stringify({slug, md})});
            setBlogStatus('ì €ì¥ ì™„ë£Œ (ë°œí–‰ í•„ìš”)');
            await loadBlogPosts();
        }

        async function publishBlog(){
            if(!confirm('ë°œí–‰í•˜ë©´ ì‚¬ì´íŠ¸(/blog)ì— ë°˜ì˜ë©ë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?')) return;
            setBlogStatus('ë°œí–‰ ì¤‘â€¦ (ìµœëŒ€ 20ì´ˆ)');
            await apiAdmin('/api/admin/blog/publish', {method:'POST', body: JSON.stringify({})});
            setBlogStatus('ë°œí–‰ ì™„ë£Œ');
        }

    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }
        .login-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .login-box {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .login-box h1 { margin-bottom: 10px; color: #fff; }
        .login-box p { margin-bottom: 30px; opacity: 0.7; }
        
        .admin-container { display: none; padding: 20px; max-width: 1400px; margin: 0 auto; }
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px; background: rgba(255,255,255,0.05);
            border-radius: 15px; margin-bottom: 20px;
        }
        .header h1 { font-size: 1.5em; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-info img { width: 40px; height: 40px; border-radius: 50%; }
        .logout-btn {
            background: #e74c3c; color: #fff; border: none;
            padding: 10px 20px; border-radius: 8px; cursor: pointer;
        }
        
        .tabs {
            display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;
        }
        .tab {
            padding: 12px 24px; background: rgba(255,255,255,0.05);
            border: none; border-radius: 10px; color: #fff;
            cursor: pointer; transition: all 0.3s;
        }
        .tab:hover, .tab.active { background: #3498db; }
        
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px; padding: 25px;
            display: none;
        }
        .panel.active { display: block; }
        .panel h2 { margin-bottom: 20px; color: #3498db; }
        
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1); padding: 20px;
            border-radius: 12px; text-align: center;
        }
        .stat-card .value { font-size: 2em; font-weight: bold; color: #3498db; }
        .stat-card .label { opacity: 0.7; margin-top: 5px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(255,255,255,0.05); }
        
        .btn {
            padding: 8px 16px; border: none; border-radius: 6px;
            cursor: pointer; font-size: 0.9em;
        }
        .btn-danger { background: #e74c3c; color: #fff; }
        .btn-primary { background: #3498db; color: #fff; }
        
        .log-entry { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); font-family: monospace; font-size: 0.85em; }
        .log-entry .time { color: #3498db; }
        .log-entry .ip { color: #e74c3c; }
        
        .refresh-btn { margin-bottom: 15px; }
    </style>
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js">

        // ===== BLOG ADMIN =====
        let blogEditor = null;

        function ensureBlogEditor(){
            if(blogEditor) return blogEditor;
            if(!window.toastui || !toastui.Editor) throw new Error('Editor library not loaded');
            blogEditor = new toastui.Editor({
                el: document.querySelector('#blogEditor'),
                height: '520px',
                initialEditType: 'wysiwyg',
                previewStyle: 'vertical',
                usageStatistics: false,
                toolbarItems: [
                    ['heading', 'bold', 'italic', 'strike'],
                    ['hr', 'quote'],
                    ['ul', 'ol', 'task'],
                    ['table', 'image', 'link'],
                    ['code', 'codeblock'],
                    ['scrollSync']
                ],
                hooks: {
                    addImageBlobHook: async (blob, callback) => {
                        try{
                            const token = localStorage.getItem('adminToken');
                            if(!token) throw new Error('ê´€ë¦¬ì ë¡œê·¸ì¸ í•„ìš”');
                            const dataUrl = await new Promise((resolve, reject)=>{
                                const r = new FileReader();
                                r.onload = ()=>resolve(String(r.result));
                                r.onerror = ()=>reject(new Error('read failed'));
                                r.readAsDataURL(blob);
                            });
                            const ext = (blob.type.split('/')[1] || 'png').replace('jpeg','jpg');
                            const filename = `img_${Date.now()}.${ext}`;
                            const res = await fetch('/api/admin/blog/upload', {
                                method:'POST',
                                headers: { 'Content-Type':'application/json', 'Authorization': `Bearer ${token}` },
                                body: JSON.stringify({ filename, dataUrl })
                            });
                            const out = await res.json();
                            if(!out.success) throw new Error(out.error||'upload failed');
                            callback(out.url, filename);
                        }catch(e){
                            alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
                        }
                        return false;
                    }
                }
            });
            return blogEditor;
        }

        async function apiAdmin(path, opts={}){
            if(!authToken) throw new Error('not logged in');
            const res = await fetch(path, {
                ...opts,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                    ...(opts.headers||{})
                }
            });
            const data = await res.json().catch(()=>({}));
            if(!res.ok || data.success === false) throw new Error(data.error || ('HTTP '+res.status));
            return data;
        }

        function setBlogStatus(msg){
            const el = document.getElementById('blogStatus');
            if(el) el.textContent = msg || '';
        }

        function editorSetMarkdown(md){
            document.getElementById('blogMd').value = md || '';
            try{ ensureBlogEditor().setMarkdown(md || ''); }catch(e){ /* ignore */ }
        }

        function editorGetMarkdown(){
            try{ return ensureBlogEditor().getMarkdown(); }
            catch(e){ return document.getElementById('blogMd').value || ''; }
        }

        async function loadBlogPosts(){
            setBlogStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
            const data = await apiAdmin('/api/admin/blog/posts');
            const list = document.getElementById('blogList');
            list.innerHTML='';
            (data.posts||[]).forEach(p=>{
                const a=document.createElement('button');
                a.className='tab';
                a.style.textAlign='left';
                a.style.width='100%';
                a.style.background='rgba(255,255,255,0.06)';
                a.style.border='1px solid rgba(255,255,255,0.10)';
                a.style.borderRadius='10px';
                a.style.padding='10px 12px';
                a.innerHTML = `<div style="font-weight:700">${p.title||p.slug}</div><div style="font-size:12px;opacity:.7">${p.slug} Â· ${p.date||''}</div>`;
                a.onclick=()=>openBlogPost(p.slug);
                list.appendChild(a);
            });
            setBlogStatus(`${(data.posts||[]).length}ê°œ`);
        }

        async function openBlogPost(slug){
            setBlogStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
            const data = await apiAdmin('/api/admin/blog/post?slug='+encodeURIComponent(slug));
            document.getElementById('blogSlug').value = data.slug;
            editorSetMarkdown(data.md);
            setBlogStatus('ë¡œë“œ ì™„ë£Œ');
        }

        function newBlogPost(){
            document.getElementById('blogSlug').value = '';
            editorSetMarkdown(`---\ntitle: ìƒˆ ê¸€\ndate: ${(new Date()).toISOString().slice(0,10)}\ntags: []\n---\n\n`);
            setBlogStatus('ìƒˆ ê¸€');
        }

        async function saveBlogPost(){
            const slug = (document.getElementById('blogSlug').value||'').trim();
            const md = editorGetMarkdown() || '';
            document.getElementById('blogMd').value = md;
            setBlogStatus('ì €ì¥ ì¤‘â€¦');
            await apiAdmin('/api/admin/blog/post', {method:'POST', body: JSON.stringify({slug, md})});
            setBlogStatus('ì €ì¥ ì™„ë£Œ (ë°œí–‰ í•„ìš”)');
            await loadBlogPosts();
        }

        async function publishBlog(){
            if(!confirm('ë°œí–‰í•˜ë©´ ì‚¬ì´íŠ¸(/blog)ì— ë°˜ì˜ë©ë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?')) return;
            setBlogStatus('ë°œí–‰ ì¤‘â€¦ (ìµœëŒ€ 20ì´ˆ)');
            await apiAdmin('/api/admin/blog/publish', {method:'POST', body: JSON.stringify({})});
            setBlogStatus('ë°œí–‰ ì™„ë£Œ');
        }

    </script>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h1>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
            <p>ìŠ¹ì¸ëœ Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
            <div id="g_id_onload"
                 data-client_id="896155827665-vc7vj9t2vmb6a1uv3jmnqbp60lf4lcm7.apps.googleusercontent.com"
                 data-callback="handleCredentialResponse"
                 data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                 data-type="standard"
                 data-size="large"
                 data-theme="filled_blue"
                 data-text="sign_in_with"
                 data-shape="rectangular"
                 data-logo_alignment="left">
            </div>
            <p id="loginError" style="color: #e74c3c; margin-top: 20px; display: none;"></p>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ -->
    <div class="admin-container" id="adminContainer">
        <div class="header">
            <h1>ğŸ“Š SENGVIS Playground ê´€ë¦¬ì</h1>
            <div class="user-info">
                <img id="userPicture" src="" alt="">
                <span id="userName"></span>
                <a class="btn btn-primary" href="/admin/project-dashboard.html" target="_blank" rel="noopener noreferrer">ğŸ“Š í”„ë¡œì íŠ¸ ëŒ€ì‹œë³´ë“œ</a>
                <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-panel="dashboard">ğŸ“ˆ ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab" data-panel="logs">ğŸ“‹ ì ‘ì† ë¡œê·¸</button>
            <button class="tab" data-panel="posts">ğŸ“ ê²Œì‹œíŒ ê´€ë¦¬</button>
            <button class="tab" data-panel="reviews">ğŸš½ ëŒ€ë˜¥ì—¬ì§€ë„ í›„ê¸°</button>
            <button class="tab" data-panel="blog">ğŸ“° ë¸”ë¡œê·¸ ê´€ë¦¬</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div class="panel active" id="dashboard">
            <h2>ì„œë²„ ìƒíƒœ</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="value" id="statUptime">-</div>
                    <div class="label">ì„œë²„ ê°€ë™ì‹œê°„</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="statCpu">-</div>
                    <div class="label">CPU ì‚¬ìš©ë¥ </div>
                </div>
                <div class="stat-card">
                    <div class="value" id="statMemory">-</div>
                    <div class="label">ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ </div>
                </div>
                <div class="stat-card">
                    <div class="value" id="statDisk">-</div>
                    <div class="label">ë””ìŠ¤í¬ ì‚¬ìš©ë¥ </div>
                </div>
                <div class="stat-card">
                    <div class="value" id="statPosts">-</div>
                    <div class="label">ê²Œì‹œê¸€ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="value" id="statReviews">-</div>
                    <div class="label">í›„ê¸° ìˆ˜</div>
                </div>
            </div>
            
            <!-- íŠ¸ë˜í”½ ê·¸ë˜í”„ -->
            <div style="margin-top: 30px;">
                <h2 style="margin-bottom: 15px;">ğŸ“Š ì‹¤ì‹œê°„ íŠ¸ë˜í”½</h2>
                <div style="background: rgba(255,255,255,0.02); border-radius: 12px; padding: 20px;">
                    <canvas id="trafficChart" height="200"></canvas>
                </div>
                <div style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
                    <div class="stat-card" style="flex: 1; min-width: 150px;">
                        <div class="value" id="statTodayHits">-</div>
                        <div class="label">ì˜¤ëŠ˜ ì ‘ì†</div>
                    </div>
                    <div class="stat-card" style="flex: 1; min-width: 150px;">
                        <div class="value" id="statHourHits">-</div>
                        <div class="label">ìµœê·¼ 1ì‹œê°„</div>
                    </div>
                    <div class="stat-card" style="flex: 1; min-width: 150px;">
                        <div class="value" id="statUniqueIps">-</div>
                        <div class="label">ê³ ìœ  IP</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary refresh-btn" onclick="loadDashboard()" style="margin-top: 20px;">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <!-- ì ‘ì† ë¡œê·¸ -->
        <div class="panel" id="logs">
            <h2>ìµœê·¼ ì ‘ì† ë¡œê·¸</h2>
            <button class="btn btn-primary refresh-btn" onclick="loadLogs()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <div id="logsList"></div>
        </div>

        <!-- ê²Œì‹œíŒ ê´€ë¦¬ -->
        <div class="panel" id="posts">
            <h2>ê²Œì‹œíŒ ê¸€ ëª©ë¡</h2>
            <button class="btn btn-primary refresh-btn" onclick="loadPosts()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <table>
                <thead>
                    <tr><th>ID</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ì‘ì„±ì¼</th><th>ê´€ë¦¬</th></tr>
                </thead>
                <tbody id="postsList"></tbody>
            </table>
        </div>



        <!-- ë¸”ë¡œê·¸ ê´€ë¦¬ -->
        <div class="panel" id="blog">
            <h2>ë¸”ë¡œê·¸ ê¸€ ê´€ë¦¬</h2>
            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:12px; align-items:center;">
                <button class="btn btn-primary" onclick="loadBlogPosts()">ğŸ”„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
                <button class="btn btn-primary" onclick="newBlogPost()">â• ìƒˆ ê¸€</button>
                <button class="btn btn-primary" onclick="saveBlogPost()">ğŸ’¾ ì €ì¥</button>
                <button class="btn btn-primary" onclick="publishBlog()">ğŸš€ ë°œí–‰(ì‚¬ì´íŠ¸ ë°˜ì˜)</button>
                <span id="blogStatus" style="opacity:.8"></span>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 2fr; gap:14px; align-items:start;">
                <div style="background: rgba(255,255,255,0.03); border-radius:12px; padding:12px;">
                    <div style="font-size:12px; opacity:.8; margin-bottom:8px;">ê¸€ ëª©ë¡</div>
                    <div id="blogList" style="display:flex; flex-direction:column; gap:8px;"></div>
                </div>

                <div style="background: rgba(255,255,255,0.03); border-radius:12px; padding:12px;">
                    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:8px;">
                        <label style="font-size:12px; opacity:.8">slug</label>
                        <input id="blogSlug" placeholder="ì˜ˆ: moltbot-intro" style="flex:1; min-width:220px; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.25); color:#fff;" />
                        <span style="font-size:12px; opacity:.6">(ì˜ë¬¸/ìˆ«ì/í•˜ì´í”ˆ)</span>
                    </div>
                    <div id="blogEditor" style="background:#fff; border-radius:12px; overflow:hidden;"></div>
                    <textarea id="blogMd" style="display:none"></textarea>
                    <div style="font-size:12px; opacity:.7; margin-top:8px; line-height:1.5">
                        ì €ì¥ì€ íŒŒì¼ë§Œ ë°”ê¾¸ê³ , <b>ë°œí–‰</b>ì„ ëˆŒëŸ¬ì•¼ ì‚¬ì´íŠ¸(/blog)ì— ë°˜ì˜ë©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
        </div>

        <!-- ëŒ€ë˜¥ì—¬ì§€ë„ í›„ê¸° -->
        <div class="panel" id="reviews">
            <h2>ëŒ€ë˜¥ì—¬ì§€ë„ í›„ê¸° ê´€ë¦¬</h2>
            <button class="btn btn-primary refresh-btn" onclick="loadReviews()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <table>
                <thead>
                    <tr><th>ì¥ì†Œ</th><th>ë³„ì </th><th>ë‚´ìš©</th><th>ì‘ì„±ì</th><th>ì‘ì„±ì¼</th><th>ê´€ë¦¬</th></tr>
                </thead>
                <tbody id="reviewsList"></tbody>
            </table>
        </div>
    </div>

    <script>
        let authToken = localStorage.getItem('adminToken');
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° í™•ì¸
        if (authToken) {
            verifyToken();
        }

        function handleCredentialResponse(response) {
            fetch('/api/admin/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ credential: response.credential })
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    authToken = data.token;
                    localStorage.setItem('adminToken', authToken);
                    showAdmin(data.user);
                } else {
                    document.getElementById('loginError').textContent = data.error || 'ë¡œê·¸ì¸ ì‹¤íŒ¨';
                    document.getElementById('loginError').style.display = 'block';
                }
            });
        }

        function verifyToken() {
            fetch('/api/admin/verify', {
                headers: { 'Authorization': `Bearer ${authToken}` }
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    showAdmin(data.user);
                } else {
                    localStorage.removeItem('adminToken');
                    authToken = null;
                }
            });
        }

        function showAdmin(user) {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userPicture').src = user.picture;
            loadDashboard();
        }

        function logout() {
            localStorage.removeItem('adminToken');
            authToken = null;
            location.reload();
        }

        // íƒ­ ì „í™˜
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.panel).classList.add('active');
                
                // íŒ¨ë„ë³„ ë°ì´í„° ë¡œë“œ
                const panel = tab.dataset.panel;
                if (panel === 'dashboard') loadDashboard();
                else if (panel === 'logs') loadLogs();
                else if (panel === 'posts') loadPosts();
                else if (panel === 'reviews') loadReviews();
                else if (panel === 'blog') { try{ ensureBlogEditor(); }catch(e){} loadBlogPosts(); }
                else if (panel === 'blog') loadBlogPosts();
            });
        });

        function adminFetch(url, options = {}) {
            return fetch(url, {
                ...options,
                headers: { ...options.headers, 'Authorization': `Bearer ${authToken}` }
            }).then(r => r.json());
        }

        let trafficChart = null;
        
        function loadDashboard() {
            adminFetch('/api/admin/stats')
                .then(data => {
                    if (data.success) {
                        document.getElementById('statUptime').textContent = data.stats.uptime;
                        document.getElementById('statCpu').textContent = data.stats.cpu;
                        document.getElementById('statMemory').textContent = data.stats.memory;
                        document.getElementById('statDisk').textContent = data.stats.disk;
                        document.getElementById('statPosts').textContent = data.stats.posts;
                        document.getElementById('statReviews').textContent = data.stats.reviews;
                    }
                });
            
            // íŠ¸ë˜í”½ ë°ì´í„° ë¡œë“œ
            adminFetch('/api/admin/traffic')
                .then(data => {
                    if (data.success) {
                        document.getElementById('statTodayHits').textContent = data.todayHits;
                        document.getElementById('statHourHits').textContent = data.hourHits;
                        document.getElementById('statUniqueIps').textContent = data.uniqueIps;
                        renderTrafficChart(data.hourlyData);
                    }
                });
        }
        
        function renderTrafficChart(hourlyData) {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            
            if (trafficChart) {
                trafficChart.destroy();
            }
            
            const labels = hourlyData.map(d => d.hour + 'ì‹œ');
            const values = hourlyData.map(d => d.count);
            
            trafficChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ì‹œê°„ë³„ ì ‘ì†',
                        data: values,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3498db',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#888' }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#888', stepSize: 1 }
                        }
                    }
                }
            });
        }

        function loadLogs() {
            adminFetch('/api/admin/logs')
                .then(data => {
                    if (data.success) {
                        document.getElementById('logsList').innerHTML = data.logs.map(log => `
                            <div class="log-entry">
                                <span class="time">${log.time}</span> - 
                                <span class="ip">${log.ip}</span> - 
                                ${log.method} ${log.path} - ${log.status} - ${log.userAgent}
                            </div>
                        `).join('');
                    }
                });
        }

        function loadPosts() {
            adminFetch('/api/admin/posts')
                .then(data => {
                    if (data.success) {
                        document.getElementById('postsList').innerHTML = data.posts.map(post => `
                            <tr>
                                <td>${post.id}</td>
                                <td>${escapeHtml(post.title)}</td>
                                <td>${escapeHtml(post.author)}</td>
                                <td>${new Date(post.createdAt).toLocaleString('ko-KR')}</td>
                                <td><button class="btn btn-danger" onclick="deletePost(${post.id})">ì‚­ì œ</button></td>
                            </tr>
                        `).join('');
                    }
                });
        }

        function loadReviews() {
            adminFetch('/api/admin/reviews')
                .then(data => {
                    if (data.success) {
                        document.getElementById('reviewsList').innerHTML = data.reviews.map(r => `
                            <tr>
                                <td>${escapeHtml(r.placeName || r.placeId)}</td>
                                <td>${'â­'.repeat(r.rating)}</td>
                                <td>${escapeHtml(r.text || '-')}</td>
                                <td>${escapeHtml(r.nickname)}</td>
                                <td>${new Date(r.createdAt).toLocaleString('ko-KR')}</td>
                                <td><button class="btn btn-danger" onclick="deleteReview('${r.placeId}', '${r.id}')">ì‚­ì œ</button></td>
                            </tr>
                        `).join('');
                    }
                });
        }

        function deletePost(id) {
            if (!confirm('ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            adminFetch(`/api/admin/posts/${id}`, { method: 'DELETE' })
                .then(data => {
                    if (data.success) loadPosts();
                    else alert('ì‚­ì œ ì‹¤íŒ¨: ' + data.error);
                });
        }

        function deleteReview(placeId, reviewId) {
            if (!confirm('ì´ í›„ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            adminFetch(`/api/admin/reviews/${placeId}/${reviewId}`, { method: 'DELETE' })
                .then(data => {
                    if (data.success) loadReviews();
                    else alert('ì‚­ì œ ì‹¤íŒ¨: ' + data.error);
                });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    

        // ===== BLOG ADMIN =====
        let blogEditor = null;

        function ensureBlogEditor(){
            if(blogEditor) return blogEditor;
            if(!window.toastui || !toastui.Editor) throw new Error('Editor library not loaded');
            blogEditor = new toastui.Editor({
                el: document.querySelector('#blogEditor'),
                height: '520px',
                initialEditType: 'wysiwyg',
                previewStyle: 'vertical',
                usageStatistics: false,
                toolbarItems: [
                    ['heading', 'bold', 'italic', 'strike'],
                    ['hr', 'quote'],
                    ['ul', 'ol', 'task'],
                    ['table', 'image', 'link'],
                    ['code', 'codeblock'],
                    ['scrollSync']
                ],
                hooks: {
                    addImageBlobHook: async (blob, callback) => {
                        try{
                            const token = localStorage.getItem('adminToken');
                            if(!token) throw new Error('ê´€ë¦¬ì ë¡œê·¸ì¸ í•„ìš”');
                            const dataUrl = await new Promise((resolve, reject)=>{
                                const r = new FileReader();
                                r.onload = ()=>resolve(String(r.result));
                                r.onerror = ()=>reject(new Error('read failed'));
                                r.readAsDataURL(blob);
                            });
                            const ext = (blob.type.split('/')[1] || 'png').replace('jpeg','jpg');
                            const filename = `img_${Date.now()}.${ext}`;
                            const res = await fetch('/api/admin/blog/upload', {
                                method:'POST',
                                headers: { 'Content-Type':'application/json', 'Authorization': `Bearer ${token}` },
                                body: JSON.stringify({ filename, dataUrl })
                            });
                            const out = await res.json();
                            if(!out.success) throw new Error(out.error||'upload failed');
                            callback(out.url, filename);
                        }catch(e){
                            alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
                        }
                        return false;
                    }
                }
            });
            return blogEditor;
        }

        async function apiAdmin(path, opts={}){
            if(!authToken) throw new Error('not logged in');
            const res = await fetch(path, {
                ...opts,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`,
                    ...(opts.headers||{})
                }
            });
            const data = await res.json().catch(()=>({}));
            if(!res.ok || data.success === false) throw new Error(data.error || ('HTTP '+res.status));
            return data;
        }

        function setBlogStatus(msg){
            const el = document.getElementById('blogStatus');
            if(el) el.textContent = msg || '';
        }

        function editorSetMarkdown(md){
            document.getElementById('blogMd').value = md || '';
            try{ ensureBlogEditor().setMarkdown(md || ''); }catch(e){ /* ignore */ }
        }

        function editorGetMarkdown(){
            try{ return ensureBlogEditor().getMarkdown(); }
            catch(e){ return document.getElementById('blogMd').value || ''; }
        }

        async function loadBlogPosts(){
            setBlogStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
            const data = await apiAdmin('/api/admin/blog/posts');
            const list = document.getElementById('blogList');
            list.innerHTML='';
            (data.posts||[]).forEach(p=>{
                const a=document.createElement('button');
                a.className='tab';
                a.style.textAlign='left';
                a.style.width='100%';
                a.style.background='rgba(255,255,255,0.06)';
                a.style.border='1px solid rgba(255,255,255,0.10)';
                a.style.borderRadius='10px';
                a.style.padding='10px 12px';
                a.innerHTML = `<div style="font-weight:700">${p.title||p.slug}</div><div style="font-size:12px;opacity:.7">${p.slug} Â· ${p.date||''}</div>`;
                a.onclick=()=>openBlogPost(p.slug);
                list.appendChild(a);
            });
            setBlogStatus(`${(data.posts||[]).length}ê°œ`);
        }

        async function openBlogPost(slug){
            setBlogStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦');
            const data = await apiAdmin('/api/admin/blog/post?slug='+encodeURIComponent(slug));
            document.getElementById('blogSlug').value = data.slug;
            editorSetMarkdown(data.md);
            setBlogStatus('ë¡œë“œ ì™„ë£Œ');
        }

        function newBlogPost(){
            document.getElementById('blogSlug').value = '';
            editorSetMarkdown(`---\ntitle: ìƒˆ ê¸€\ndate: ${(new Date()).toISOString().slice(0,10)}\ntags: []\n---\n\n`);
            setBlogStatus('ìƒˆ ê¸€');
        }

        async function saveBlogPost(){
            const slug = (document.getElementById('blogSlug').value||'').trim();
            const md = editorGetMarkdown() || '';
            document.getElementById('blogMd').value = md;
            setBlogStatus('ì €ì¥ ì¤‘â€¦');
            await apiAdmin('/api/admin/blog/post', {method:'POST', body: JSON.stringify({slug, md})});
            setBlogStatus('ì €ì¥ ì™„ë£Œ (ë°œí–‰ í•„ìš”)');
            await loadBlogPosts();
        }

        async function publishBlog(){
            if(!confirm('ë°œí–‰í•˜ë©´ ì‚¬ì´íŠ¸(/blog)ì— ë°˜ì˜ë©ë‹ˆë‹¤. ì§„í–‰í• ê¹Œìš”?')) return;
            setBlogStatus('ë°œí–‰ ì¤‘â€¦ (ìµœëŒ€ 20ì´ˆ)');
            await apiAdmin('/api/admin/blog/publish', {method:'POST', body: JSON.stringify({})});
            setBlogStatus('ë°œí–‰ ì™„ë£Œ');
        }

    </script>
</body>
</html>
